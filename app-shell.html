
<style>

  :host {
    display: block;

    --drawer-background-color: var(--app-background-color);
    --drawer-color:            var(--app-dark-text);
    --drawer-width:            256px;

    --header-background-color: var(--app-primary-color);
    --header-color:            var(--app-primary-color-text);
    --header-background-image: 'url(#)';

    --toolbar-font-size: 20px;

    --drawer-content-container-mixin: {};

    --drawer-item-mixin: {
      display:         block;
      padding:         0px 16px;
      text-decoration: none;
      color:           var(--app-secondary-text);
      line-height:     40px;
    };

    --drawer-item-selected-mixin: {
      color:       var(--app-dark-text);
      font-weight: bold;
    };
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  app-drawer-layout {
    display:  block;
    position: relative;
  }

  app-drawer-layout {
    --app-drawer-width: var(--drawer-width);
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  app-drawer {
    position:            fixed;
    top:                -120px;
    right:               0px;
    bottom:             -120px;
    left:                0px;
    visibility:          hidden;
    transition-property: visibility; 
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  app-drawer[opened] {
    visibility: visible;
  }

  app-drawer {    
    --app-drawer-width: var(--drawer-width);

    --app-drawer-content-container: {

      color:            var(--drawer-color);
      background-color: var(--drawer-background-color);

      @apply --drawer-content-container-mixin;
    };
  }

  /* Create a deep shadow when drawer is persitently shown ie. large screens. */
  app-drawer-layout:not([narrow]) app-drawer {

    --app-drawer-content-container: {

      color:            var(--drawer-color);
      background-color: var(--drawer-background-color);
      box-shadow:       6px 0px 10px 0px rgba(0, 0, 0, 0.14),
                        1px 0px 18px 0px rgba(0, 0, 0, 0.12),
                        3px 0px 5px -1px rgba(0, 0, 0, 0.4);

      @apply --drawer-content-container-mixin;
    };
  }
  
  #make-scrollable {
    position: relative;
    height:   100%; 
    overflow: auto;
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  #make-scrollable::after {
    content:          '';
    position:         absolute;
    top:              0px;
    right:            0px;
    bottom:           0px;
    left:             0px;
    transition:       opacity 0.2s ease-in;
    opacity:          0;
    pointer-events:   none;    
    background-color: var(--drawer-background-color);
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  #make-scrollable.not-loaded::after {
    opacity: 1;
  }

  #drawer-background-slot::slotted(*) {
    position: absolute;
    top:      0px;  
    right:    0px;
    bottom:   0px;
    left:     0px;
    z-index: -1;
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  app-toolbar {
    display:        flex;
    align-items:    center;
    position:       relative;
    height:         64px;
    padding:        0px 16px;
    pointer-events: none;
  }

  app-toolbar {    
    font-size: var(--toolbar-font-size);
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  app-toolbar * {
    pointer-events: auto;
  }

  .drawer-list {
    display: block;
  }

  .drawer-item {
    @apply --drawer-item-mixin;
  }
  
  .drawer-label {
    cursor: pointer;
  }

  a {
    text-decoration: none;
    color:           var(--app-secondary-text);
  }

  .drawer-list a.iron-selected {
    @apply --drawer-item-selected-mixin;
  }

  .drawer-item iron-icon {
    top: -2px;
  }

  .show-divider {
    margin-top: 12px;
    padding:    16px 0px;
    border-top: 2px solid var(--app-divider-color);
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  app-header {    
    display: block;
  }

  app-header {
    color:            var(--header-color);
    background-color: var(--header-background-color);

    --app-header-background-rear-layer: {
      background-color: var(--header-background-color);
    };

    --app-header-background-front-layer: {
      background-image:    var(--header-background-image);
      background-position: center center;
    };
  }

  #menu-btn-wrapper {
    position: relative;
    height:   40px;
  }

  app-drawer-layout:not([narrow]) #menu-btn-wrapper {
    display: none;
  }

  #menu-btn-wrapper.not-loaded {
    display: block !important;
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
  */
  #menu-btn-placeholder,
  paper-icon-button {
    display:     inline-block;
    position:    relative;
    padding:     8px;
    line-height: 1;
    width:       40px;
    height:      40px;
    box-sizing:  border-box;
  }

  #menu-btn-placeholder {
    position: absolute;
    top:      0px;
    left:     0px;
  }

  app-header paper-icon-button {
    --paper-icon-button-ink-color: var(--header-color);
  }

  avatar-image {
    width: 40px;

    --avatar-image-icon-height: 28px;
    --avatar-image-icon-width:  28px;
  }
 
  /* Cannot use app-toolbar with paper-tabs set to sticky on iOS Safari. */
  #bottomToolbar {
    position:  relative;
    width:     100%;
    height:    64px;
    padding:   0px 16px;
    font-size: var(--toolbar-font-size);
  }

  #bottomToolbar[hidden] {
    display: none;
  }

  #pages {
    display: block; /* Important for Safari. */

    /* Safari scroll flicker workaround. */
    transition: opacity 0.2s ease-in;
  }

  #pages.not-loaded {
    opacity: 0;
  }

  #accountRequiredOverlay {
    display:          none;
    justify-content:  center;
    align-items:      center;
    text-align:       center;
    position:         fixed;
    top:              0px;
    right:            0px;
    bottom:           0px;
    left:             0px;
    padding:          16px;
    transition:       opacity 0.2s ease-in;
    background-color: var(--app-background-color);
    pointer-events:   auto;
  }

  .hide-account-required {
    opacity: 0;
  }

  .show-account-required {
    opacity: 1;
  }

  #warningToast {
    display:      flex;
    align-items:  center;
    padding-left: 52px;
    color:        var(--app-warning-color);
  }

  #warningToast iron-icon {
    position: absolute;
    left:     16px;
  }

  .toasts-w-btn {
    display:         flex;
    align-items:     center;
    justify-content: space-between;
  }

  .toasts-w-btn paper-button {
    color: var(--app-secondary-color);
  }

  .toasts-w-btn paper-button.cta {
    background-color: var(--app-secondary-color);
    color:            var(--app-secondary-color-text);
  }

  paper-toast.not-loaded {
    display: none;
  }

  /*
    Placeholder styles for fast app shell rendering model 
    used before the elements are upgraded to custom elements.
    
    640px matches `app-drawer-layout` default 'responsive-width' property. 
  */
  @media (min-width: 640px) {

    app-drawer {
      width: var(--drawer-width);
      visibility:         visible;
    }

    app-drawer.drawer-align-end {
      left: unset;
    }
    
    app-header-layout {
      display:  block;
      position: absolute;
      top:      0px;
      right:    0px;
      left:     unset;
      width:    calc(100vw - 256px);
    }

    app-header-layout.drawer-align-end {
      right: unset;
      left:  0px;
    }

    #menu-btn-wrapper.not-loaded {
      display: none !important;
    }

  }

</style>


<app-location route="{{route}}" 
              url-space-regex="^[[_rootPath]]">
</app-location>
<app-route route="{{route}}"
           pattern="[[_rootPath]]:page"
           data="{{_routeData}}"
           tail="{{_subroute}}">
</app-route>


<app-localstorage-document id="autoColorModeStorage"
                           key="autoColorModeToggle" 
                           data="[[_autoColorMode]]">
</app-localstorage-document>
<app-localstorage-document id="darkModeStorage"
                           key="darkModeToggle" 
                           data="[[_darkMode]]">
</app-localstorage-document>
<app-localstorage-document id="persistenceStorage"
                           key="persistenceToggle" 
                           data="[[_persistence]]">
</app-localstorage-document>


<app-drawer-layout id="layout" 
                   fullbleed 
                   narrow="{{narrow}}"
                   force-narrow=[[hideMenu]]>

  <!-- MENU DRAWER -->

  <app-drawer id="drawer"
              align="[[drawerAlign]]"
              slot="drawer" 
              swipe-open="[[narrow]]"> 

    <div id="make-scrollable" 
         class="not-loaded">

      <slot id="drawer-background-slot" 
            name="drawer-background-slot">
      </slot>

      <app-toolbar>Menu</app-toolbar>

      <iron-selector selected="[[page]]" 
                     attr-for-selected="page" 
                     class="drawer-list" 
                     role="navigation">

        <template is="dom-repeat" 
                  items="[[_slottedViewElementData]]">

          <a page="[[item.page.value]]" 
             href="[[_rootPath]][[item.page.value]]">
            <div class="drawer-item">
              <iron-icon icon="[[item.icon.value]]" 
                         hidden="[[__computeHideIcon(item.icon.value)]]">
              </iron-icon>
              <span class="drawer-label">[[item.label.value]]</span>
            </div>
          </a>

        </template>

      </iron-selector>

      <div class$="[[_showDivider]]">

        <template is="dom-repeat" 
                  items="[[_slottedOverlayElementData]]">
          <div class="drawer-item" 
               on-click="__slottedDrawerElementClicked">
            <iron-icon icon="[[item.icon.value]]" 
                       hidden="[[__computeHideIcon(item.icon.value)]]">
            </iron-icon>
            <span class="drawer-label">[[item.label.value]]</span>
          </div>
        </template>

        <template is="dom-if" 
                  if="[[!noUsers]]">
          <div class="drawer-item" 
               on-click="__drawerAccountClicked">
            <iron-icon icon="[[_accountIcon]]"></iron-icon>
            <span class="drawer-label">Account</span>
          </div>
        </template> 

        <div class="drawer-item" 
             on-click="__drawerSettingsClicked">
          <iron-icon icon="app-icons:settings"></iron-icon>
          <span class="drawer-label">Settings</span>
        </div> 

        <iron-selector selected="[[page]]" 
                       attr-for-selected="page" 
                       class="drawer-list" 
                       role="navigation">

          <template is="dom-repeat" 
                    items="[[_slottedBottomViewElementData]]">

            <a page="[[item.page.value]]" 
               href="[[_rootPath]][[item.page.value]]">
              <div class="drawer-item">
                <iron-icon icon="[[item.icon.value]]" 
                           hidden="[[__computeHideIcon(item.icon.value)]]">
                </iron-icon>
                <span class="drawer-label">[[item.label.value]]</span>
              </div>
           </a>

          </template>

        </iron-selector>
      </div>

    </div>

  </app-drawer>


  <!-- MAIN HEADER & CONTENT -->

  <!-- DO NOT use 'has-scroll-region' in app-header-layout so that 
       it will use the document scroller for proper iOS useage. -->
  <app-header-layout id="app-shell-main-panel">
    <app-header id="header" 
                slot="header" 
                scroll-target="document"
                threshold="[[threshold]]"
                condenses
                effects="waterfall blend-background">

      <app-toolbar id="topToolbar">

        <div id="menu-btn-wrapper"
             class="not-loaded">

          <div id="menu-btn-placeholder">
            <svg viewBox="0 0 24 24" 
                 preserveAspectRatio="xMidYMid meet" 
                 focusable="false" 
                 style="pointer-events: none; display: block; width: 100%; height: 100%;">
              <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
            </svg>
          </div>

          <paper-icon-button icon="app-shell-icons:menu" 
                             drawer-toggle
                             aria-label="Opens menu drawer">
          </paper-icon-button>

        </div>

        <div hidden="[[!title]]" 
             main-title>
          [[title]]
        </div>

        <slot name="top-toolbar-slot"></slot>

        <avatar-image alt="Account sign in or sign up."
                      button
                      hidden="[[noUsers]]"
                      icon="[[_accountIcon]]"
                      src="[[_avatar]]"
                      on-avatar-image-clicked="__avatarClicked">
        </avatar-image>

      </app-toolbar>

      <template is="dom-repeat" 
                items="[[__createMiddleToolbars(headerSize)]]">

        <app-toolbar class="toolbars">
          <slot name="[[item.slotName]]"></slot>
        </app-toolbar>
        
      </template>

      <!-- Cannot use app-toolbar and paper-tabs with sticky on iOS Safari. -->
      <div id="bottomToolbar" 
           hidden="[[__computeBottomToolbarHidden(headerSize)]]">

        <slot name="bottom-toolbar-slot"></slot>

      </div>

    </app-header>

    <!-- Useful for a sticky search bar with an autocomplete below it. -->    
    <slot id="underHeaderStickySlot" 
          name="under-header-sticky-slot">
    </slot>

    <div id="pages"
         class="not-loaded">

      <iron-pages selected="[[page]]"
                  attr-for-selected="page"
                  fallback-selection="view404"
                  role="main">

        <!-- Dynamically imported. -->
        <slot id="viewsSlot" 
              name="views-slot">
        </slot>

        <slot id="viewsBottomSlot" 
              name="views-bottom-slot">
        </slot> 

        <view-404 page="view404"></view-404>
      </iron-pages>

      <slot name="footer-slot"></slot>

      <div id="accountRequiredOverlay" 
           class="hide-account-required">
        <h1>You must be signed in to use this app.</h1>
      </div>

    </div>

  </app-header-layout>
</app-drawer-layout>


<!-- Overlays. -->
<slot id="overlaysSlot" 
      name="overlays-slot">
</slot>


<app-account id="account"
             dark-mode="[[_darkMode]]"
             user="[[currentUser]]"
             header-image="[[accountHeaderImage]]"
             header-size="[[accountHeaderSize]]"
             on-app-account-avatar-changed="__accountAvatarChangedHandler"
             on-app-account-reauth-needed="__accountReauthNeededHandler"
             on-app-account-signout-clicked="__accountSignoutClickedHandler">
</app-account>

<app-settings id="settings"
              auto-color-mode="[[_autoColorMode]]"
              dark-mode="[[_darkMode]]"
              hide-auto-color-mode="[[_hideAutoColorMode]]"
              persistence="[[_persistence]]">
</app-settings>

<app-auth id="auth" 
          avatar="[[_avatar]]">
</app-auth>


<!-- For use with `app-file-system`. -->
<paper-toast id="fsToast" 
             class="toasts-w-btn not-loaded" 
             duration="Infinity">
  <paper-button on-click="__fsToastRenameButtonClicked">
    RENAME
  </paper-button>
  <paper-button class="cta" 
                on-click="__fsToastGoButtonClicked">
    GO
  </paper-button>
</paper-toast>


<!-- Used by multiple custom elements via `utils.js` message()/warn(). -->
<paper-toast id="toast"
             class="not-loaded">
</paper-toast>

<paper-toast id="warningToast"
             class="not-loaded">
  <iron-icon icon="app-shell-icons:warning"></iron-icon>
</paper-toast>

<paper-toast id="confirmToast" 
             class="toasts-w-btn not-loaded">
  <paper-button on-click="__confirmToastUndoButtonClicked">
    UNDO
  </paper-button>
</paper-toast>

<paper-toast id="swToast" 
             class="toasts-w-btn not-loaded" 
             duration="Infinity" 
             always-on-top>
  <paper-button on-click="__swToastDismissButtonClicked">
    DISMISS
  </paper-button>
  <paper-button class="cta" 
                on-click="__swToastRefreshButtonClicked">
    REFRESH
  </paper-button>
</paper-toast>
